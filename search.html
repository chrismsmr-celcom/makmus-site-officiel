<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Résultats de recherche — MAKMUS</title>
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
<style>
body { font-family:'Inter',sans-serif; padding:2rem; background:#fff; color:#111; }
.search-masterbar{ font-family:'Libre Baskerville', serif; font-size:1.5rem; margin-bottom:1rem; border-bottom:1px solid #ddd; padding-bottom:0.5rem;}
#searchResultsContainer a{ display:block; font-family:'Libre Baskerville', serif; font-size:1.1rem; color:#111; text-decoration:none; border-bottom:1px solid #eee; padding:0.3rem 0; transition:color 0.2s; }
#searchResultsContainer a:hover{ color:#e63946; }
</style>
</head>
<body>

<div class="search-masterbar">
  <h2 id="searchKeyword"></h2>
</div>
<div id="searchResultsContainer">Chargement...</div>

<script>
const API_KEY = "pub_4e1227be068d43c7b03da109494a3907";
const CACHE_DURATION = 2*60*60*1000;

// Récupérer le mot-clé de l'URL
const params = new URLSearchParams(window.location.search);
const query = params.get("q");
document.getElementById("searchKeyword").textContent = query ? `Résultats pour : "${query}"` : "Recherche";

// Fonction fetch avec cache
async function fetchNewsWithCache(key,url){
  const c = localStorage.getItem(key);
  const t = localStorage.getItem(key+"_time");
  if(c && t && Date.now()-t<CACHE_DURATION) return JSON.parse(c);
  try{
    const r = await fetch(url);
    const d = await r.json();
    localStorage.setItem(key,JSON.stringify(d));
    localStorage.setItem(key+"_time",Date.now());
    return d;
  }catch(e){ return c? JSON.parse(c): {results:[]}; }
}

// Requête API recherche
async function loadSearchResults(q){
  if(!q) return;
  const data = await fetchNewsWithCache(`search_${q}`, `https://newsdata.io/api/1/news?apikey=${API_KEY}&q=${encodeURIComponent(q)}&language=fr`);
  const results = Array.isArray(data.results)?data.results:[];
  const container = document.getElementById("searchResultsContainer");
  container.innerHTML = "";
  if(!results.length){
    container.innerHTML = "<p>Aucun résultat trouvé.</p>";
    return;
  }
  results.slice(0,20).forEach(article=>{
    const a = document.createElement("a");
    a.href = article.link;
    a.target="_blank";
    a.textContent = article.title;
    container.appendChild(a);
  });
}

// Charger la recherche
loadSearchResults(query);
</script>
</body>
</html>
